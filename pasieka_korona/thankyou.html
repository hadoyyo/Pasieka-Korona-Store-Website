<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Pasieka Korona</title>
    <!-- icon-->
    <link rel="shortcut icon" href="images/mini-logo.png">
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
</head>
<body>
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light">
    <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="index.html">
            <img src="images/logo.png" alt="Logo" width="120">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                <li class="nav-item"><a class="nav-link" aria-current="page" href="index.html">Strona główna</a></li>
                <li class="nav-item"><a class="nav-link" href="shop.html">Sklep</a></li>
                <li class="nav-item"><a class="nav-link" href="about.html">O nas</a></li>
                <li class="nav-item"><a class="nav-link" href="gallery.html">Galeria</a></li>
                <li class="nav-item"><a class="nav-link" href="contact.html">Kontakt</a></li>
            </ul>
            <form class="d-flex">
                <button class="btn btn-outline-dark" type="button" onclick="location.href='cart.html'">
                    <i class="bi-cart-fill me-1"></i>
                    Koszyk
                    <span class="badge bg-dark text-white ms-1 rounded-pill" id="cartCount"></span>
                </button>                        
            </form>
        </div>
    </div>
</nav>
<!-- Header-->
<header>
    <h1 class="display-5 fw-bolder text-center">Dziękujemy!</h1>
    <hr>
</header>
<!-- Section-->
<section class="container text-center">
    <h3>Twoje zamówienie zostało złożone pomyślnie. Potwierdzenie zamówienia wyślemy na podany przez Ciebie e-mail.</h3>
    <div id="przelewTradycyjny" class="text-center" style="display: none;">
        <br>
        <h3>Dokonaj wpłaty w kwocie <span id="total-price-tradycyjny"></span> zł w celu rozpoczęcia realizacji zamówienia na poniższy numer konta:</h3>
        <h2 class="display-5">36203000451130000010283270</h2>
        <h3>W tytule przelewu wpisz poniższą formułę:</h3>
        <h2 class="display-5">Zamówienie <span id="order-code-tradycyjny"></span></h2>
        <h3>Potwierdzenie przyjęcia zamówienia zostanie dostarczone po otrzymaniu wpłaty.</h3>
    </div>
    <div id="przelewNaTelefon" class="text-center" style="display: none;">
        <br>
        <h3>Dokonaj wpłaty w kwocie <span id="total-price-telefon"></span> zł w celu rozpoczęcia realizacji zamówienia na poniższy numer telefonu:</h3>
        <h2 class="display-5">694 498 173</h2>
        <h3>W tytule przelewu wpisz poniższą formułę:</h3>
        <h2 class="display-5">Zamówienie <span id="order-code-telefon"></span></h2>
        <h3>Potwierdzenie przyjęcia zamówienia zostanie dostarczone po otrzymaniu wpłaty.</h3>
    </div>
    <div id="odbior" class="text-center" style="display: none;">
        <br>
        <h3>Numer Twojego zamówienia:</h3>
        <h2 class="display-5"><span id="order-code-odbior"></span></h2>
    </div>
    <br>
    <button class="btn btn-outline-dark" type="button" onclick="location.href='index.html'">Wróć do sklepu</button>
</section>

<!-- Footer-->
<footer class="py-4 bg-dark">
    <div class="container">
      <div class="facebook-link-container mb-2">
      <a href="https://www.facebook.com/p/Pasieka-Korona-100088721704740/" class="text-decoration-none d-flex facebook-link" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook me-2" viewBox="0 0 16 16">
          <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/>
        </svg>
        Facebook
      </a></div>
      <div class="facebook-link-container">
      <a href="Regulamin.pdf" class="text-decoration-none d-flex facebook-link" target="_blank">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook me-2" viewBox="0 0 16 16">
          <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M4.5 9a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1zM4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1z"/>
        </svg>Regulamin
      </a></div><br>
      <p class="m-0 text-center text-white">Pasieka Korona 2025 &copy; Wszelkie prawa zastrzeżone</p>
    </div>
</footer>

<!-- Modals -->
<div class="modal fade" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 fw-bolder" id="articleName"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <img src="" id="articleImage" alt="Zdjęcie artykułu" style="max-width: 100%; box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.5);">
                <br>
                <br>
                <h3 class="text-center" id="articlePrice"></h3>
                <p class="text-center" id="articleWeight"></p>
                <p id="articleDescription" style="text-align: justify;"></p>
            </div>
            <div class="modal-footer">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-outline-dark" id="addToCartBtn">
                        <i class="bi-cart-fill me-1"></i>Do koszyka
                    </button>
                    <input type="number" class="form-control quantity-input" id="quantityInput" value="1" min="1" style="width: 60px; border: 1px solid black;">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addedToCartModal" tabindex="-1" aria-labelledby="addedToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addedToCartModalLabel">Sukces!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Produkt został dodany do koszyka.
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script src="js/confetti.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="text/javascript"> emailjs.init('g0sG9J97clC_NQd0k') </script>

<script>
    // Function to start confetti
    const start = () => {
        setTimeout(function() {
            confetti.start();
        }, 1000); // Start confetti after 1 second
    };

    // Function to stop confetti
    const stop = () => {
        setTimeout(function() {
            confetti.stop();
        }, 5000); // Stop confetti after 5 seconds
    };

    function displayPaymentMethod() {
        const person = JSON.parse(localStorage.getItem('person'));
        const totalPrice = localStorage.getItem('TotalPrice');
        const orderCode = localStorage.getItem('orderCode');
        if (person && person.paymentMethod === "Przelew tradycyjny") {
            document.getElementById('przelewTradycyjny').style.display = 'block';
            document.getElementById('total-price-tradycyjny').innerHTML = `${totalPrice}`;
            document.getElementById('order-code-tradycyjny').innerHTML = `${orderCode}`;
        } else {
            document.getElementById('przelewTradycyjny').style.display = 'none';
        }
        if (person && person.paymentMethod === "BLIK Przelew na numer telefonu") {
            document.getElementById('przelewNaTelefon').style.display = 'block';
            document.getElementById('total-price-telefon').innerHTML = `${totalPrice}`;
            document.getElementById('order-code-telefon').innerHTML = `${orderCode}`;
        } else {
            document.getElementById('przelewNaTelefon').style.display = 'none';
        }
        if (person && person.paymentMethod === "Gotówka przy odbiorze (odbiór osobisty)") {
            document.getElementById('odbior').style.display = 'block';
            document.getElementById('order-code-odbior').innerHTML = `${orderCode}`;
        } else {
            document.getElementById('odbior').style.display = 'none';
        }
    }

    function clearCart() {
        localStorage.removeItem('cart');  // Remove the cart from localStorage
        console.log('Cart cleared');  // Debug: Potwierdź, że koszyk został wyczyszczony
        updateCartCount();  // Update the cart count to zero
    }

    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalItems = cart.reduce((total, product) => total + product.quantity, 0);
        document.getElementById('cartCount').innerText = totalItems;
    }

    function sendFormData() {
        // Pobierz dane z localStorage
        var orderCode = localStorage.getItem('orderCode');
        var cart = JSON.parse(localStorage.getItem('cart'));
        var person = JSON.parse(localStorage.getItem('person'));
        var price = calculateTotalPrice();

        // Debugging: Sprawdź dane, które są wysyłane
        console.log('Order Code:', orderCode);
        console.log('Cart:', cart);
        console.log('Person:', person);
        console.log('Total Price:', price);

        // Utwórz wiadomość email
        var message = 'Dane klienta\nImię: ' + person.imie + '\nNazwisko: ' + person.nazwisko + '\nUlica: ' + person.ulica + ' ' + person.numerBudynku + '\nNumer lokalu: ' + person.numerLokalu + '\nMiejscowość: ' + person.miejscowosc + '\nKod pocztowy: ' + person.kodPocztowy + '\nWojewództwo: ' + person.province + '\nTelefon: ' + person.telefon + '\nE-mail: ' + person.email + '\n\nKoszyk:\n';
        cart.forEach(function(item) {
            message += '- ' + item.name + ', cena: ' + item.price + ' zł, ilość: ' + item.quantity + '\n';
        });
        message += '\nDostawa: ' + person.dostawca + '\nCena całkowita: ' + price + ' zł + ' + person.deliveryCost + ' zł (cena dostawy)\nMetoda płatności: ' + person.paymentMethod;

        emailjs.send("service_nvewjve", "template_tovapv7", {
            order_code: orderCode,
            cart_contents: message,
        });
    }

    function calculateTotalPrice() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        return cart.reduce((total, product) => total + product.price * product.quantity, 0);
    }

    window.onload = function() {
        sendFormData();
        start();
        stop();
        clearCart();
        displayPaymentMethod();
    };
</script>
</body>
</html>
